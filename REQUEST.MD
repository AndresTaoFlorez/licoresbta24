# AN√ÅLISIS CR√çTICO DE PERFORMANCE - Lighthouse Score 32

## CONTEXTO URGENTE
Mi sitio web licoresbta24.com tiene un puntaje de Performance de **32/100** en Lighthouse.

**M√©tricas actuales detectadas:**
- ‚ùå CLS (Cumulative Layout Shift): Cr√≠tico - elementos saltando durante carga
- ‚ùå SI (Speed Index): Muy lento - contenido visible tarda mucho
- ‚ùå FCP (First Contentful Paint): Lento - primera pintura demorada
- ‚ùå LCP (Largest Contentful Paint): Cr√≠tico - contenido principal tarda >4s
- ‚ö†Ô∏è TBT (Total Blocking Time): Alto - JavaScript bloqueando interacci√≥n

**Stack:** React + Vite + SCSS + Redux
**Target:** Subir a m√≠nimo 80-90 en las pr√≥ximas 2 horas

---

## AN√ÅLISIS REQUERIDO

### 1. EJECUTA LIGHTHOUSE LOCALMENTE
```bash
# Genera reporte detallado
npm run build
npx lighthouse http://localhost:4173 --view --preset=desktop
```

**Analiza el reporte y encuentra:**
- üî¥ Principales culpables de LCP (im√°genes grandes, fuentes, JS bloqueante)
- üî¥ Qu√© causa el CLS (elementos sin dimensiones, fuentes cargando)
- üî¥ Scripts bloqueando FCP/SI
- üî¥ Recursos sin comprimir o cach√©

---

## PROBLEMAS COMUNES A VERIFICAR (EN ORDEN DE IMPACTO)

### üö® PRIORIDAD CR√çTICA 1: LCP (Largest Contentful Paint)

**Busca estos problemas:**
```jsx
// ‚ùå PROBLEMA: Im√°genes hero sin optimizar
<img src="/hero-background.jpg" /> // 2MB+, bloquea LCP

// ‚úÖ SOLUCI√ìN ESPERADA:
<img 
  src="/hero-background.webp"
  srcSet="/hero-sm.webp 640w, /hero-md.webp 1024w, /hero-lg.webp 1920w"
  sizes="100vw"
  fetchpriority="high"
  decoding="async"
  alt="Hero"
/>
```

**Acciones:**
- Detecta la imagen m√°s grande above-the-fold
- Convierte a WebP/AVIF
- A√±ade `fetchpriority="high"` al elemento LCP
- Preload del recurso cr√≠tico:
```html
<link rel="preload" as="image" href="/hero.webp" fetchpriority="high">
```

---

### üö® PRIORIDAD CR√çTICA 2: CLS (Layout Shift)

**Busca estos problemas:**
```jsx
// ‚ùå PROBLEMA: Im√°genes sin dimensiones
<img src="/product.jpg" />

// ‚úÖ SOLUCI√ìN:
<img src="/product.jpg" width="300" height="400" loading="lazy" />
```

**Acciones:**
- A√±ade `width` y `height` a TODAS las im√°genes
- Reserva espacio para fuentes con `font-display: swap`
- Detecta componentes que causan reflow (Slider, ModernCategories, etc.)
```scss
// Reservar espacio para fuentes
@font-face {
  font-family: 'Poppins';
  font-display: swap; // cr√≠tico para evitar CLS
  src: url('/fonts/poppins.woff2') format('woff2');
}
```

---

### üö® PRIORIDAD CR√çTICA 3: FCP/SI (Render Bloqueante)

**Busca estos problemas:**
```javascript
// ‚ùå PROBLEMA: Bundle monol√≠tico
import { BrowserRouter } from 'react-router-dom';
import { Provider } from 'react-redux';
import SwipeToEnter from './pages/SwipeToEnter';
import Home from './pages/Home';
import CategoryPage from './pages/CategoryPage';
// 500KB+ de JS antes de renderizar

// ‚úÖ SOLUCI√ìN: Code splitting
const SwipeToEnter = lazy(() => import('./pages/SwipeToEnter'));
const Home = lazy(() => import('./pages/Home'));
const CategoryPage = lazy(() => import('./pages/CategoryPage'));
```

**Acciones:**
- Implementa `React.lazy()` en TODAS las rutas
- Lazy load de componentes pesados (ProductCard, Slider, ModernCategories)
- Defer de scripts no cr√≠ticos

---

### üö® PRIORIDAD CR√çTICA 4: TBT (JavaScript Bloqueante)

**Busca estos problemas:**
- Redux store con datos masivos en initial state
- Animaciones con JavaScript en lugar de CSS
- Event listeners pesados en scroll
- Componentes sin React.memo()

**Acciones:**
```javascript
// ‚úÖ Memoizar componentes pesados
export default React.memo(ModernProductCard);

// ‚úÖ Virtualizar listas largas
import { FixedSizeList } from 'react-window';

// ‚úÖ Throttle/debounce en scroll
import { debounce } from 'lodash-es'; // solo importar lo necesario
```

---

## CONFIGURACI√ìN VITE OPTIMIZADA PARA SCORE 80+

**Modifica `vite.config.js` con esta config:**
```javascript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react-swc';
import { compression } from 'vite-plugin-compression2';
import { imagetools } from 'vite-imagetools';

export default defineConfig({
  plugins: [
    react(),
    compression({ algorithm: 'brotliCompress' }),
    imagetools(),
  ],
  
  build: {
    target: 'es2020',
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
        pure_funcs: ['console.log'],
      },
    },
    
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          router: ['react-router-dom'],
          redux: ['@reduxjs/toolkit', 'react-redux'],
        },
      },
    },
    
    cssCodeSplit: true,
    reportCompressedSize: false,
  },
  
  server: {
    hmr: { overlay: false },
  },
});
```

---

## CHECKLIST DE VERIFICACI√ìN INMEDIATA

Revisa estos archivos en orden:

### 1. `index.html`
```html
<!-- ‚úÖ Debe tener preconnect -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- ‚úÖ Preload de recurso cr√≠tico -->
<link rel="preload" as="image" href="/hero.webp" fetchpriority="high">

<!-- ‚úÖ Fuentes optimizadas -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap">
```

### 2. `App.jsx`
```javascript
// ‚ùå Busca imports directos
import SwipeToEnter from './pages/SwipeToEnter';

// ‚úÖ Debe ser lazy
const SwipeToEnter = lazy(() => import('./pages/SwipeToEnter'));
```

### 3. Componentes de imagen
```jsx
// ‚ùå Busca im√°genes sin atributos
<img src="/product.jpg" />

// ‚úÖ Debe tener
<img 
  src="/product.webp" 
  width="300" 
  height="400" 
  loading="lazy"
  decoding="async"
/>
```

### 4. `main.scss`
```scss
// ‚ùå Busca imports masivos
@import 'components/_modern-card.scss';
@import 'components/_product-list.scss';
// ... 20 imports m√°s

// ‚úÖ Critical CSS inline, resto lazy
```

### 5. Redux Store
```javascript
// ‚ùå Busca initial state pesado
const initialState = {
  products: [...1000 productos], // NO!
};

// ‚úÖ Estado vac√≠o, cargar async
const initialState = {
  products: [],
  loading: false,
};
```

---

## PLAN DE ACCI√ìN EN 2 HORAS

**‚è±Ô∏è HORA 1: Quick Wins (0-60 min)**
1. [10 min] Code splitting de rutas con React.lazy()
2. [15 min] A√±adir width/height a todas las im√°genes
3. [10 min] Convertir im√°genes cr√≠ticas a WebP
4. [15 min] Preload de recursos cr√≠ticos (hero image, fuente)
5. [10 min] font-display: swap en todas las fuentes

**‚è±Ô∏è HORA 2: Optimizaciones Profundas (60-120 min)**
1. [20 min] Optimizar vite.config.js
2. [20 min] Lazy load de componentes pesados
3. [15 min] React.memo() en componentes que re-renderizan
4. [15 min] Comprimir assets con imagetools
5. [10 min] Verificar bundle con rollup-plugin-visualizer

---

## FORMATO DE RESPUESTA ESPERADO

Para cada problema encontrado:
```
‚ùå PROBLEMA DETECTADO: [Descripci√≥n t√©cnica]
üìç Ubicaci√≥n: src/presentation/pages/Home/Home.jsx:45
üìä Impacto: LCP +2.3s, CLS +0.15
üîß SOLUCI√ìN: [C√≥digo espec√≠fico a cambiar]
‚è±Ô∏è Tiempo: 10 minutos
üéØ Ganancia esperada: +15 puntos en score
```

---

## ENTREGABLES FINALES

1. ‚úÖ Lista de archivos modificados con cambios espec√≠ficos
2. ‚úÖ Nuevo `vite.config.js` optimizado
3. ‚úÖ Snippet de optimizaci√≥n para cada m√©trica cr√≠tica
4. ‚úÖ Comando para verificar mejoras:
```bash
npm run build && npm run preview
# Luego ejecutar Lighthouse
```
5. ‚úÖ Score estimado despu√©s de optimizaciones

---

## M√âTRICAS OBJETIVO
```
Antes ‚Üí Despu√©s
Performance: 32 ‚Üí 80+
CLS: X ‚Üí <0.1
LCP: X ‚Üí <2.5s
FCP: X ‚Üí <1.8s
SI: X ‚Üí <3.4s
TBT: X ‚Üí <200ms
```

**S√â ESPEC√çFICO, T√âCNICO Y DIRECTO.**
Quiero c√≥digo exacto a cambiar, no teor√≠a.
Prioriza las optimizaciones con mayor impacto primero.